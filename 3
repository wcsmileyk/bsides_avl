from dateutil import parser
from collections import namedtuple


def parse_syslog(log_message, header_fields=4, deliminator=' '):
    Syslog = namedtuple('Syslog', ['event_time', 'log_source', 'application', 'message_body'])
    
    dt, log_source, log_app, message_body = log_message.split(' ', 3)
    event_time = parser.parse(dt)
    return Syslog(event_time=event_time, 
                  log_source=log_source, 
                  application=log_app, 
                  message_body=message_body)


def parse_fw(fw_message):
    msg_dict = {'additional_data': []}
    for pair in fw_message.split(' '):
        try:
            k, v = pair.split('=', 1)
            msg_dict[k] = v
        except ValueError:
            msg_dict['additional_data'].append(pair)
    return msg_dict


def get_user_ovpn(ovpn_message):
    user_pattern = re.compile('\w+/(\d{1,3}\.){3}\d{1,3}')

    return user_pattern.search(ovpn_message)




